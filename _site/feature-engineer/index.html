

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>Feature Engineering - Yan Guochen</title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="Yan Guochen">
<meta property="og:title" content="Feature Engineering">


  <link rel="canonical" href="http://localhost:4000/feature-engineer/">
  <meta property="og:url" content="http://localhost:4000/feature-engineer/">



  <meta property="og:description" content="数据和特征的质量决定了机器学习的上限。">





  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2022-02-07T01:00:00-08:00">








  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Person",
      "name" : "Yan Guochen",
      "url" : "http://localhost:4000",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->


<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Yan Guochen Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="http://localhost:4000/images/apple-touch-icon-57x57.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="60x60" href="http://localhost:4000/images/apple-touch-icon-60x60.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="76x76" href="http://localhost:4000/images/apple-touch-icon-76x76.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="120x120" href="http://localhost:4000/images/apple-touch-icon-120x120.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="152x152" href="http://localhost:4000/images/apple-touch-icon-152x152.png?v=M44lzPylqQ">
<link rel="apple-touch-icon" sizes="180x180" href="http://localhost:4000/images/apple-touch-icon-180x180.png?v=M44lzPylqQ">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-32x32.png?v=M44lzPylqQ" sizes="32x32">
<link rel="icon" type="image/png" href="http://localhost:4000/images/android-chrome-192x192.png?v=M44lzPylqQ" sizes="192x192">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-96x96.png?v=M44lzPylqQ" sizes="96x96">
<link rel="icon" type="image/png" href="http://localhost:4000/images/favicon-16x16.png?v=M44lzPylqQ" sizes="16x16">
<link rel="manifest" href="http://localhost:4000/images/manifest.json?v=M44lzPylqQ">
<link rel="mask-icon" href="http://localhost:4000/images/safari-pinned-tab.svg?v=M44lzPylqQ" color="#000000">
<link rel="shortcut icon" href="/images/favicon.ico?v=M44lzPylqQ">
<meta name="msapplication-TileColor" content="#000000">
<meta name="msapplication-TileImage" content="http://localhost:4000/images/mstile-144x144.png?v=M44lzPylqQ">
<meta name="msapplication-config" content="http://localhost:4000/images/browserconfig.xml?v=M44lzPylqQ">
<meta name="theme-color" content="#ffffff">
<link rel="stylesheet" href="http://localhost:4000/assets/css/academicons.css"/>

<script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: { autoNumber: "all" } } }); </script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>

<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://localhost:4000/">Yan Guochen</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/publications/">Publications</a></li>
          
            
            <li class="masthead__menu-item"><a href="http://localhost:4000/year-archive/">Blog Posts</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <p>数据和特征的质量决定了机器学习的上限。</p>

<p>特征工程包括：</p>

<h2 id="特征处理基于sklearn">特征处理（基于sklearn）</h2>

<p>特征处理包括1. 特征清洗，2. 数据预处理。</p>

<h3 id="特征清洗">特征清洗</h3>

<p>主要任务是对异常样本的处理。对”异常“的定义并不统一，简单起见，离群点是会被认为为异常点的。在统计上离群点往往和低概率相关联，以下方法都是以概率思想识别离群点：</p>

<h4 id="基于统计量的方法">基于统计量的方法</h4>

<p><strong>箱型图分析</strong>：根据其四分位数，计算极差以及分位差（思想：找出离密度高的群体较远的点）</p>

<p>一般认为：如果数据量足够大，1/4和3/4分位差之外的数据可以认为是异常点。如果数据量不够大，则认为$(D_{\frac{1}{4}}-1.5\times(D_{\frac34}-D_{\frac14}), D_{\frac{3}{4}}+1.5\times(D_{\frac34}-D_{\frac14})$的之外的数据为异常数据。</p>

<p><strong>正态图分析</strong>：$3\sigma$原则</p>

<p>基于统计的方法的缺点是：1. 非常依赖于数据集的数据分布，数据集中的数据是否满足某种分布对效果影响很大，2. 离群点的意义有多种。</p>

<p>一般来说可以在初期尝试使用这些方法，观察模型效果是否提升。</p>

<h4 id="knn">KNN</h4>

<p>它是基于相似度衡量的模型的一种，异常点和正常点的分布不同，因此二者的相似度低。</p>

<p>主要思想是：对于每个点计算它的k近邻距离，一般认为异常点的第k邻距离更大。所以在计算时，就是先计算出每个点的k近邻距离，然后进行排序，选择距离最大的几个为异常点。</p>

<p>它受数据维度的影响比较大，当维度比较低的时候表现很好。事实上基于距离的方法在高维时表现都不佳。</p>

<h4 id="聚类">聚类</h4>

<p>思想：找出分布稀疏且离密度高的群体较远的点。</p>

<p>它只能给出是不是异常点，不能量化每个数据点的异常程度。</p>

<h4 id="local-outlier-factor">Local Outlier Factor</h4>

<p>基于密度的LOF算法要更简单、直观。它不需要对数据的分布做太多要求，还能量化每个数据点的异常程度（outlierness）。</p>

<p><a href="https://youth-49.github.io/2022/02/LOF/">Local Outlier Factor (youth-49.github.io)</a></p>

<h4 id="one-class-svm">One-class SVM</h4>

<p><a href="https://www.cnblogs.com/wj-1314/p/10701708.html">Python机器学习笔记：异常点检测算法——One Class SVM - 战争热诚 - 博客园 (cnblogs.com)</a></p>

<h4 id="iforest">IForest</h4>

<p><a href="https://cloud.tencent.com/developer/article/1631110">【异常检测】孤立森林（Isolation Forest）算法简介 - 云+社区 - 腾讯云 (tencent.com)</a></p>

<h3 id="数据预处理基于sklearnpreprocess">数据预处理（基于sklearn.preprocess）</h3>

<p>对于未经处理的特征，可能存在以下问题：</p>

<ol>
  <li>量纲不统一</li>
  <li>在任务上该特征存在信息冗余</li>
  <li>需要将定性特征转化为定量特征</li>
  <li>Missing value</li>
  <li>信息利用率低</li>
</ol>

<p>与之对应地，有如下解决方法：</p>

<p><strong>无量纲化</strong></p>

<p>无量纲化包括对数据标准化，区间缩放，归一化。</p>

<p>标准化：使该特征符合均值为0，方差为1的分布：</p>

\[x' = \frac{x-\overline x}{\sigma}\]

<p>区间缩放：使得数据等比例地缩放到一个给定区间：</p>

\[x' = \frac{s-Min}{Max-Min}\]

<p>也修改了原数据分布的均值和方差，可以将标准化看作特殊的区间缩放。</p>

<p>归一化：归一化并不属于无量纲化的一种，归一化将每个样本的特征向量的模长变为1。</p>

<p>$L_p$归一化公式为：</p>

\[x' = \frac{x}{(\sum_{i}^{n}x_i^p)^{\frac{1}{p}}}\]

<p>常采用$L_2$归一化。</p>

<p><strong>二值化（离散化）</strong></p>

<p>对某些特定任务，二值数据或离散化数据即可满足要求。连续实数值可能会造成信息冗余。一般的做法是设置阈值。</p>

<p><strong>对定性特征进行one-hot编码或哑编码（Dummy coding）</strong></p>

<p>为一种定性特征的每个取值设定一个定量值往往需要大量的专家知识和调参工作，通常的做法是采用one-hot coding或dummy coding的方式——假设有N种定性值，则：</p>

<p>one-hot coding：将这一个特征扩展为N种特征，当原始特征值为第i种定性值时，第i个扩展特征赋值为1，其他扩展特征赋值为0。</p>

<p>dummy coding：将这一个特征扩展为N-1种特征，将其中一种定性值编码为全0.</p>

<p>对于线性模型来说，使用one-hot编码或哑编码后的特征可达到非线性的效果。</p>

<p><strong>Missing value</strong></p>

<p>对缺失值的处理包括丢弃和填充。填充缺失值往往用该特征取值的均值。</p>

<p><strong>数据变化</strong></p>

<p>常见的数据变换有基于多项式的、基于指数函数的、基于对数函数的。</p>

<p>以上操作均可借助sklearn.preprocess库实现：</p>

<table>
  <thead>
    <tr>
      <th>类</th>
      <th>功能</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>StandardScaler</td>
      <td>无量纲化</td>
      <td>标准化，基于特征矩阵的列，将特征值转换至服从标准正态分布</td>
    </tr>
    <tr>
      <td>MinMaxScaler</td>
      <td>无量纲化</td>
      <td>区间缩放，基于最大最小值，将特征值转换到[0, 1]区间上</td>
    </tr>
    <tr>
      <td>Normalizer</td>
      <td>归一化</td>
      <td>基于特征矩阵的行，将样本向量转换为“单位向量”</td>
    </tr>
    <tr>
      <td>Binarizer</td>
      <td>二值化</td>
      <td>基于给定阈值，将定量特征按阈值划分</td>
    </tr>
    <tr>
      <td>OneHotEncoder</td>
      <td>哑编码</td>
      <td>将定性数据编码为定量数据</td>
    </tr>
    <tr>
      <td>Imputer</td>
      <td>缺失值计算</td>
      <td>计算缺失值，缺失值可填充为均值等</td>
    </tr>
    <tr>
      <td>PolynomialFeatures</td>
      <td>多项式数据转换</td>
      <td>多项式数据转换</td>
    </tr>
    <tr>
      <td>FunctionTransformer</td>
      <td>自定义单元数据转换</td>
      <td>使用单变元的函数来转换数据</td>
    </tr>
  </tbody>
</table>

<p>对于文本特征，将自然语言预处理成向量，一般有如下方法：</p>

<ol>
  <li>词袋模型：建立词库，样本文本中该词出现即对应分量为1。缺点是词与词之间相互独立，向量维数过高，向量过稀疏，对于未见词处理不佳。</li>
  <li>n-gram改进的词袋模型：建立词库时，将n-gram也作为一个词加入词库，这样考虑了n个词的依赖关系，同时增大了词库大小。</li>
  <li>词袋+TF-IDF</li>
  <li>Word2Vec &amp; Glove</li>
</ol>

<h5 id="tf-idf">TF-IDF</h5>

<p>统计每个词的词频并归一化（防止倾向于长文档）：</p>

\[TF(w_i) = \frac{count(w_i)}{\sum_jcount(w_j)}\]

<p>然后筛去出现频率高且与主题相关性低的词，同时增加与主题相关性强的词的权重：</p>

\[IDF(w_i) = log(\frac{语料库中文档总数}{包含w_i的文档数+eps})\]

<p>eps是防止分母为0的，一般取1。</p>

<p>定义TF-IDF为：</p>

\[TF-IDF = TF \times IDF\]

<p>相比于之前的词袋模型，TF-IDF显著降低了普遍出现的词的权重（如的，了，是），增加了有标志性词的权重。在文档的关键词提取中，按照TF-IDF值排序，靠前的可以视为文章的关键词。</p>

<p>TF-IDF的优点是简单快速，缺点是上述对”重要性“的定义不够全面，可能不能适应一些情景。另外，该方法假设了词之间的独立性，缺少语义信息。</p>

<p>还有一种预处理方式是组合特征，如借助GBDT+LR：先用GBDT训练模型，得到解释性良好的特征集合，再将组合特征与原特征一起训练。</p>

<h2 id="特征选择">特征选择</h2>

<p>特征选择的目的是选出对任务有意义的特征输入机器学习模型，通常要考虑特征的：</p>

<ol>
  <li>分布情况：如果一个特征的方差相对很小，<strong>可能</strong>说明样本在这个特征上几乎没有差异，是一个无效特征。</li>
  <li>与目标的相关性。</li>
</ol>

<h3 id="filter">Filter</h3>

<p>对特征评分，设置阈值，选择高于（或低于）阈值的特征。</p>

<p>这种方法的缺点是假设了特征的独立性，有可能将有用的关联特征也过滤掉。</p>

<p>对于分类问题，可采用卡方检验和互信息法。</p>

<p>对于回归问题，可以采用皮尔森相关系数和最大信息系数。</p>

<p><strong>方差选择法</strong></p>

<p>计算每个特征的方差，根据阈值选择方差大于阈值的特征。</p>

<p><strong>相关系数法</strong></p>

<p>先要计算各个特征对目标值的相关系数以及相关系数的P值。</p>

<p>给定一组样本数据$(X_i. Y_i)$：</p>

\[COV(X, Y) = E[(X-E(X))(Y-E(Y))] = E(XY)-E(X)E(Y)\]

<p>协方差为正时，二者正相关，为负时负相关。为了消除随机变量取值的影响，除以标准差以单位化（值域为[-1, 1]）：</p>

\[\begin{align}
r &amp;= \frac{COV(X,Y)}{\sigma _X \sigma_Y} \\ &amp;= \frac{\sum_{i=1}^n(X_i-\overline X)(Y_i-\overline Y)}{\sqrt{\sum_{i=1}^n(X_i-\overline X)^2}\sqrt{\sum_{i=1}^n(Y_i-\overline Y)^2}}
\end{align}\]

<p>这种相关系数是线性相关系数，在非线性条件下表现可能不佳。</p>

<p><strong>卡方检验</strong></p>

<p>是一种假设检验，要给出显著性水平$\sigma$，也可以用其他检验如T-检验，Z-检验，要根据数据分布确定。</p>

<p>经典的卡方检验是检验定性自变量对定性因变量的相关性。假设自变量有N种取值，因变量有M种取值，考虑自变量等于i且因变量等于j的样本频数的观察值与期望的差距，构建统计量：</p>

\[\chi^2 = \sum\frac{(A-E)^2}{E}\]

<p>其中A是实际值（实际频数），E是假设自变量与因变量独立时的理论频数。这个统计量用于衡量实际值和理论值的差异程度，包含了以下两个信息：</p>

<ol>
  <li>实际值与理论值偏差的绝对大小（由于平方的存在，差异是被放大的）</li>
  <li>差异程度与理论值的相对大小</li>
</ol>

<p><a href="https://www.pianshen.com/article/6812117772/">统计学-卡方检验与卡方分布 - 程序员大本营 (pianshen.com)</a> （其中喝牛奶的例子有点错误）</p>

<p><strong>互信息与最大信息系数</strong></p>

<p><a href="https://youth-49.github.io/2022/02/MI-MIC/">Mutual Information and Maximum Information Coeffient (youth-49.github.io)</a></p>

<p><img src="https://raw.githubusercontent.com/Youth-49/ImageHosting/main/img/2022-02-07-feature-engineer.png" alt="" /></p>

<h3 id="wrapper">Wrapper</h3>

<p>根据目标函数，每次选择若干特征或排除若干特征。</p>

<p>（转）Wrapper 这一类特征选择方法，应该来说是比较科学的，但是也是非常耗时，工业界在生产环境中很少使用，非常耗时，也是一个 NP 复杂的问题，一般通过不断迭代，然后每次加入一个特征，来训练模型，使用模型评估比如 AUC 或者 MSE 等函数评估是否将特征加入到特征子集中。</p>

<p>递归消除特征法使用一个基模型来进行多轮训练，每轮训练后，移除若干权值系数的特征，再基于新的特征集进行下一轮训练。</p>

<p>sklearn官方解释：对特征含有权重的预测模型(例如，线性模型对应参数coefficients)，RFE通过递归减少考察的特征集规模来选择特征。首先，预测模型在原始特征上训练，每个特征指定一个权重。之后，那些拥有最小绝对值权重的特征被踢出特征集。如此往复递归，直至剩余的特征数量达到所需的特征数量。</p>

<p>RFECV 通过交叉验证的方式执行RFE，以此来选择最佳数量的特征：对于一个数量为d的feature的集合，他的所有的子集的个数是2的d次方减1(包含空集)。指定一个外部的学习算法，比如SVM之类的。通过该算法计算所有子集的validation error。选择error最小的那个子集作为所挑选的特征。</p>

<h3 id="embedded">Embedded</h3>

<p>先使用某些机器学习算法或模型进行训练，得到各个特征的权值系数，根据系数选择特征。有些机器学习方法本身就具有对特征进行打分的机制，或者很容易将其运用到特征选择任务中，例如回归模型，SVM，决策树，随机森林等等。</p>

<p>（1）回归模型</p>

<p>回归模型最终会训练出各特征的权重，组成一个回归方程，则可以根据回归方程中的权重进行筛选，剔除一些较小的权重。</p>

<p>（2）SVM</p>

<p>SVM最终的分界函数是由边界上的点（特征）决定的，也就是说这些特征是比较重要的，其它特征则可以结合业务情况进行相应的删减。</p>

<p>（3）决策树</p>

<p>决策树结点的构建顺序和特征的重要性有关，则可以根据情况将一些靠近叶子结点的特征进行删减。</p>

<p>（4）随机森林</p>

<p>随机森林进行特征重要性评估，可以借助oob估计，通过对特征引入噪音，如果模型效果降低，则说明该特征较为重要。</p>

<p>（5）GBDT</p>

<p>先计算单棵树中特征分裂后损失的减少值，然后计算出多棵树的均值，即可比较出特征的重要性。</p>

<p>（6）XGboost</p>

<p>XGboost是通过该特征每棵树中分裂次数的和去计算的，比如这个特征在第一棵树分裂1次，第二棵树2次……，那么这个特征的得分就是(1+2+…)。</p>

<p>（7）基于惩罚项的特征选择</p>

<p>L1正则化具有截断性，L2正则化具有缩放效应，所以我们可以很好的利用线性模型的两种正则化选择特征。使用L1范数作为惩罚项的线性模型(Linear models)会得到稀疏解：大部分特征对应的系数为0。即起到了减少特征的作用。</p>

<p>以上均可借助sklearn.feature_selection实现：</p>

<table>
  <thead>
    <tr>
      <th>类</th>
      <th>所属方式</th>
      <th>说明</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>VarianceThreshold</td>
      <td>Filter</td>
      <td>方差选择法</td>
    </tr>
    <tr>
      <td>SelectKBest</td>
      <td>Filter</td>
      <td>可选关联系数、卡方校验、最大信息系数作为得分计算的方法</td>
    </tr>
    <tr>
      <td>RFE</td>
      <td>Wrapper</td>
      <td>递归地训练基模型，将权值系数较小的特征从特征集合中消除</td>
    </tr>
    <tr>
      <td>SelectFromModel</td>
      <td>Embedded</td>
      <td>训练基模型，选择权值系数较高的特征</td>
    </tr>
  </tbody>
</table>

<h2 id="降维">降维</h2>

<p>可能由于特征矩阵过大，导致计算量大，训练时间长的问题，因此降低特征矩阵维度也是必不可少的。常见的降维方法除了以上提到的基于L1惩罚项的模型以外，另外还有主成分分析法（PCA）和线性判别分析（LDA），线性判别分析本身也是一个分类模型。PCA和LDA有很多的相似点，其本质是要将原始的样本映射到维度更低的样本空间中，但是PCA和LDA的映射目标不一样：<strong>PCA是为了让映射后的样本具有最大的发散性；而LDA是为了让映射后的样本有最好的分类性能</strong>。所以说PCA是一种无监督的降维方法，而LDA是一种有监督的降维方法。</p>



    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->
<a href="/sitemap/">Sitemap</a>
<!-- end custom footer snippets -->

        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
      <li><a href="http://github.com/Youth-49"><i class="fab fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="http://localhost:4000/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Yan Guochen. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://github.com/academicpages/academicpages.github.io">AcademicPages</a>, a fork of <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="http://localhost:4000/assets/js/main.min.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', '', 'auto');
  ga('send', 'pageview');
</script>






  </body>
</html>

